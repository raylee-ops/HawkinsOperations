# IR-2026-01-25: Wazuh Rule 100052 - Critical System File Modified (hosts.ics)

**Incident ID:** 2026-01-25-HOWE01-100052
**Severity:** High (Rule Level 12) - Downgraded to Informational after analysis
**Final Verdict:** BENIGN - Microsoft Internet Connection Sharing auto-generated file
**MITRE Techniques:** N/A (False Positive)
**Platforms:** Windows
**Detection:** Wazuh Rule ID 100052
**Agent:** HOWE01 (Agent ID: 003)
**Affected File:** `C:\Windows\System32\drivers\etc\hosts.ics`
**Analyst:** HawkinsOps SOC Team
**Investigation Date:** 2026-01-25
**Report Version:** 1.0
**Last Updated:** 2026-01-27

---

## EXECUTIVE SUMMARY

On January 25, 2026, at 17:55:52 UTC, Wazuh agent HOWE01 (003) triggered a Level 12 alert for Rule 100052 ("Critical system file modified - Possible system compromise"). The alert was generated when the file `C:\Windows\System32\drivers\etc\hosts.ics` was modified.

**Investigation Outcome:** After thorough analysis including local file validation and content inspection, the SOC team determined this to be a **BENIGN** event. The `hosts.ics` file is automatically generated and maintained by Microsoft Internet Connection Sharing (ICS) and contains legitimate IP-to-hostname mappings for the local network. The file header explicitly warns against manual modification, confirming this is a system-managed file.

**Actions Taken:**
- Alert triaged and validated within detection timeframe
- Local PowerShell validation performed to inspect file contents
- File confirmed to contain only ICS-generated mappings with copyright notice
- Alert categorized as expected system behavior
- Documentation prepared for future reference

**Recommended Actions:**
- Consider tuning Rule 100052 to exclude `hosts.ics` from triggering critical alerts
- Add exception for `C:\Windows\System32\drivers\etc\hosts.ics` in Wazuh FIM configuration
- Update SOC runbook to document this known false positive

---

## 1. DETECTION

**Alert Name:** Critical system file modified - Possible system compromise
**Rule ID:** 100052
**Rule Level:** 12 (High)
**Trigger:** File Integrity Monitoring (FIM) detected modification to critical system file

**Indicators:**
- **Log Source:** Wazuh FIM (File Integrity Monitoring)
- **Event Timestamp:** Jan 25, 2026 @ 17:55:52.839 UTC
- **Agent Name:** HOWE01
- **Agent ID:** 003
- **Manager Name:** ho-sr-wm-01
- **File Path:** `C:\Windows\System32\drivers\etc\hosts.ics`
- **Rule Description:** "Critical system file modified - Possible system compromise"
- **Rule Groups:** critical_files, file_integrity, syscheck

**Initial Context:**
- [x] Affected system: HOWE01 (Windows endpoint)
- [x] User account involved: SYSTEM (auto-generated by ICS service)
- [x] Time of detection: 2026-01-25 17:55:52 UTC
- [x] Alert severity: Level 12 (High/Critical threshold)
- [x] Single system affected (no lateral indicators)

**Detection Evidence:**
See evidence file: `evidence/03_threat_hunting_howe01_agent.png` and `evidence/04_events_table_rule100052.png`

---

## 2. TRIAGE (5 minutes)

**Objective:** Determine if this is a true positive and assess scope

**Timeline:**
- **17:55:52 UTC:** Alert triggered by Wazuh FIM
- **17:56:00 UTC:** SOC analyst reviewed Threat Hunting dashboard
- **17:58:00 UTC:** Confirmed single event, no related alerts
- **18:00:00 UTC:** Triage complete - proceeding to investigation

### Validation Steps:
- [x] Verified alert is genuine (not system noise)
- [x] Checked affected system online status - HOWE01 active
- [x] Identified service account: NT AUTHORITY\SYSTEM
- [x] Reviewed recent activity on HOWE01 - no other suspicious alerts
- [x] Checked for similar alerts on other systems - NONE found
- [x] Reviewed Threat Hunting dashboard filters (Level 12+, HOWE01 agent)

### Key Questions:
1. **Is this expected/authorized activity?**
   - UNKNOWN at triage - requires file content inspection

2. **Does timing correlate with business hours/user activity?**
   - Event occurred at 17:55 UTC (afternoon EST) - normal business hours

3. **Are there other concurrent suspicious alerts?**
   - NO - Dashboard shows only 1 Level 12+ alert for HOWE01 in 24-hour window

4. **What is the potential business impact?**
   - MEDIUM - hosts file modifications can enable DNS poisoning/redirection attacks
   - However, `hosts.ics` is distinct from standard `hosts` file

### Triage Findings:
- **Alert Count:** 1 total event matching filter criteria
- **Authentication Failures:** 0
- **Authentication Success:** 0
- **Scope:** Single system (HOWE01), single file
- **Initial Assessment:** Requires investigation to determine legitimacy of `hosts.ics` modification

**Evidence:**
- Threat Hunting Overview: `evidence/02_threat_hunting_level12_filter.png`
- HOWE01 Agent Dashboard: `evidence/03_threat_hunting_howe01_agent.png`
- Events Table: `evidence/04_events_table_rule100052.png`

### Escalation Criteria:
- Multiple systems affected → NOT APPLICABLE
- Confirmed malicious activity → NOT CONFIRMED
- Production system impacted → NOT APPLICABLE
- **Decision:** Proceed with investigation before escalation

---

## 3. INVESTIGATION (30 minutes)

**Objective:** Gather evidence and understand the nature of `hosts.ics` file

### Investigation Timeline:
- **18:00 UTC:** Begin investigation phase
- **18:05 UTC:** Reviewed event detail JSON in Wazuh dashboard
- **18:10 UTC:** Researched `hosts.ics` file purpose via Microsoft documentation
- **18:15 UTC:** Performed local PowerShell validation on HOWE01
- **18:20 UTC:** Analyzed file contents - confirmed ICS auto-generated
- **18:25 UTC:** Determined BENIGN verdict
- **18:30 UTC:** Investigation complete

### Data Collection:

**Wazuh Event Details:**
Full event JSON inspected via Wazuh dashboard showing:
- 805 available fields in event record
- Rule group classification: critical_files, file_integrity, syscheck
- File path: `C:\Windows\System32\drivers\etc\hosts.ics`
- Modification timestamp: 1/25/2026 4:06:01 PM (local system time)

**Evidence:** `evidence/06_event_detail_json_full.png`

**Local System Validation (PowerShell):**

```powershell
# Executed on HOWE01 via PowerShell
Get-Item "C:\Windows\System32\drivers\etc\hosts.ics" | Select-Object FullName, Length, LastWriteTime

# Output:
FullName      : C:\Windows\System32\drivers\etc\hosts.ics
Length        : 439 bytes
LastWriteTime : 1/25/2026 4:06:01 PM

Get-Content "C:\Windows\System32\drivers\etc\hosts.ics" -ErrorAction Stop

# Output:
# Copyright (c) 1993-2001 Microsoft Corp.
#
# This file has been automatically generated for use by Microsoft Internet
# Connection Sharing. It contains the mappings of IP addresses to host names
# for the home network. Please do not make changes to the HOSTS.ICS file.
# Any changes may result in a loss of connectivity between machines on the
# local network.
#

172.25.176.1 HO-WE-01.mshome.net # 2031 1 5 24 22 6 1 919
```

**Evidence:** `evidence/05_powershell_validation_hosts_ics_content.png`

### File Analysis:

**File Metadata:**
- **Full Path:** `C:\Windows\System32\drivers\etc\hosts.ics`
- **File Size:** 439 bytes
- **Last Modified:** 1/25/2026 4:06:01 PM
- **Purpose:** Microsoft Internet Connection Sharing host mappings

**File Contents:**
```
# Copyright (c) 1993-2001 Microsoft Corp.
#
# This file has been automatically generated for use by Microsoft Internet
# Connection Sharing. It contains the mappings of IP addresses to host names
# for the home network. Please do not make changes to the HOSTS.ICS file.
# Any changes may result in a loss of connectivity between machines on the
# local network.
#

172.25.176.1 HO-WE-01.mshome.net # 2031 1 5 24 22 6 1 919
```

**Analysis:**
1. **File Origin:** Auto-generated by Microsoft ICS service (legitimate Windows component)
2. **Content:** Single IP-to-hostname mapping for local network
   - IP: 172.25.176.1 (RFC 1918 private address - valid for local network)
   - Hostname: HO-WE-01.mshome.net (.mshome.net is Microsoft HomeGroup domain)
3. **Warning Header:** File explicitly states it's auto-generated and warns against manual editing
4. **No Malicious Indicators:** No suspicious domains, external IPs, or redirection attempts
5. **Expected Behavior:** ICS updates this file when network configuration changes

### Artifacts Collected:
- [x] Wazuh event detail (full JSON - 805 fields)
- [x] PowerShell file metadata output
- [x] PowerShell file content output
- [x] Screenshots of Wazuh dashboards (overview, threat hunting, events)
- [x] Filter configuration metadata (CSV export)

### Research Findings:

**Microsoft Internet Connection Sharing (ICS):**
- Built-in Windows feature for sharing internet connections between computers
- Automatically manages DHCP and DNS for connected devices
- Maintains `hosts.ics` file for local hostname resolution
- File updates are triggered by network configuration changes
- Legitimate system behavior - not an indicator of compromise

**hosts.ics vs hosts file:**
- `hosts` (no extension) - System-wide DNS override file (user-editable)
- `hosts.ics` - ICS-specific mapping file (auto-managed by ICS service)
- Rule 100052 monitors both files as "critical system files"
- Modification of `hosts` would warrant investigation
- Modification of `hosts.ics` is expected when ICS is active

---

## 4. CONTAINMENT (15 minutes)

**Objective:** Prevent further damage while preserving evidence

### Containment Decision:

**CONTAINMENT NOT REQUIRED**

**Justification:**
- Event determined to be BENIGN system behavior
- No indicators of compromise identified
- File contents verified as legitimate ICS auto-generated mappings
- No malicious domains, IPs, or redirection attempts present
- No evidence of persistence mechanisms or lateral movement
- System functionality not impacted

### Actions NOT Taken (and why):

**Network Isolation:**
- NOT REQUIRED - No malicious activity detected

**Account Lockout:**
- NOT APPLICABLE - Modification performed by SYSTEM account (ICS service)

**Process Termination:**
- NOT REQUIRED - No malicious processes identified

### Preservation Steps:
- [x] Screenshots captured from Wazuh dashboards
- [x] PowerShell validation output documented
- [x] Event JSON preserved in Wazuh (805 fields retained)
- [x] Evidence organized in incident folder structure

---

## 5. ERADICATION (30 minutes)

**Objective:** Remove threat completely from environment

### Eradication Decision:

**ERADICATION NOT REQUIRED**

**Justification:**
- No malicious artifacts identified
- File modification was legitimate system behavior
- hosts.ics content verified as benign
- No persistence mechanisms installed
- No indicators of compromise present

### Cleanup Actions:
- N/A - No cleanup required for benign event

---

## 6. RECOVERY

**Objective:** Restore normal operations safely

### Recovery Decision:

**RECOVERY NOT REQUIRED**

**Justification:**
- System was never compromised
- Normal operations were not disrupted
- No services were disabled or modified
- Network connectivity remained functional throughout event

### Monitoring:
- [x] Continued monitoring of HOWE01 via Wazuh FIM
- [x] No additional suspicious activity detected in 24-hour post-event window
- [x] System operating normally

---

## 7. DOCUMENTATION

### Timeline (All times UTC)

| Time | Event | Action Taken |
|------|-------|--------------|
| 2026-01-25 16:06:01 | hosts.ics file modified on HOWE01 (local time 4:06 PM) | ICS service auto-updated mapping |
| 2026-01-25 17:55:52 | Wazuh Rule 100052 triggered (Level 12 alert) | Alert generated in SIEM |
| 2026-01-25 17:56:00 | SOC analyst reviewed Threat Hunting dashboard | Triage initiated |
| 2026-01-25 17:58:00 | Confirmed single event, no lateral indicators | Scope assessment |
| 2026-01-25 18:00:00 | Triage complete | Proceed to investigation |
| 2026-01-25 18:05:00 | Reviewed event detail JSON | Evidence collection |
| 2026-01-25 18:10:00 | Researched hosts.ics purpose | Context gathering |
| 2026-01-25 18:15:00 | PowerShell validation executed on HOWE01 | Local file inspection |
| 2026-01-25 18:20:00 | File contents analyzed - Microsoft copyright confirmed | Legitimacy verified |
| 2026-01-25 18:25:00 | BENIGN verdict determined | Investigation complete |
| 2026-01-25 18:30:00 | Alert closed as false positive | Case closure |
| 2026-01-27 01:00:00 | Incident report documentation finalized | Repository archival |

---

## 8. LESSONS LEARNED

### Root Cause Analysis

**Why did this alert trigger?**
- Wazuh Rule 100052 monitors all files in `C:\Windows\System32\drivers\etc\` directory
- Rule does not differentiate between user-editable `hosts` file and system-managed `hosts.ics`
- ICS service legitimately updated `hosts.ics` with network mapping changes
- File modification triggered FIM event → Rule 100052 fired → Level 12 alert generated

**Was this a true or false positive?**
- **False Positive** - Alert correctly detected file modification, but modification was benign system behavior
- Rule is functioning as designed, but lacks tuning for ICS-related files

### What Went Well

1. **Fast Triage:** Alert reviewed within 5 minutes of generation
2. **Effective Filtering:** Threat Hunting dashboard filters (Level 12+, agent-specific) isolated event quickly
3. **Thorough Investigation:** Local validation via PowerShell provided definitive evidence
4. **Evidence Preservation:** Comprehensive screenshot capture and documentation
5. **Proper Scoping:** Confirmed single-system, single-file event with no lateral indicators

### What Could Be Improved

1. **Rule Tuning:** Rule 100052 should exclude `hosts.ics` or lower severity for ICS-managed files
2. **Detection Logic:** Differentiate between user-editable critical files vs system-managed files
3. **Documentation:** Add `hosts.ics` to known false positives runbook for faster future triage
4. **Automation:** Consider auto-enrichment to flag ICS-related events during alert generation

### Action Items

**Immediate Actions:**
- [x] Document hosts.ics as known false positive in SOC runbook
- [x] Add incident to portfolio evidence pack for hiring manager review
- [x] Create sanitized incident report for public repository

**Short-term Actions (1-2 weeks):**
- [ ] Update Wazuh Rule 100052 to exclude `hosts.ics` from critical severity
- [ ] Add FIM exception for `C:\Windows\System32\drivers\etc\hosts.ics`
- [ ] Test rule modification in development environment
- [ ] Deploy tuned rule to production Wazuh manager

**Long-term Actions (1-3 months):**
- [ ] Review all FIM rules for similar false positive patterns
- [ ] Implement automated enrichment for ICS/system service-related events
- [ ] Conduct quarterly review of Level 12+ false positives
- [ ] Develop detection logic for *actual* malicious hosts file modifications

**Training:**
- [ ] Share findings with SOC team in weekly sync
- [ ] Add hosts.ics case study to SOC training materials
- [ ] Document Windows system-managed files for analyst reference

---

## 9. EVIDENCE APPENDIX

### Evidence Files

All supporting evidence is located in the `evidence/` subdirectory:

1. **01_wazuh_overview_dashboard.png** - Wazuh overview showing alert counts
2. **02_threat_hunting_level12_filter.png** - Threat Hunting filtered to Level 12+ alerts
3. **03_threat_hunting_howe01_agent.png** - Agent-specific dashboard for HOWE01
4. **04_events_table_rule100052.png** - Events table showing Rule 100052 trigger
5. **05_powershell_validation_hosts_ics_content.png** - Local PowerShell file validation
6. **06_event_detail_json_full.png** - Full event detail JSON (805 fields)
7. **07_events_table_duplicate.png** - Alternate events table view
8. **08_threat_hunting_dashboard_alternate.png** - Alternate dashboard view
9. **wazuh_filter_metadata.csv** - Dashboard filter configuration

See `evidence_index.md` for detailed evidence-to-report section mapping.

---

## 10. REFERENCES

### Internal Documentation
- HawkinsOps Incident Response Playbook Index: `../../playbooks/00-Playbook-Index.md`
- IR Template: `../../IR-Template.md`
- Wazuh Rule Documentation: (internal wiki reference)

### External Resources
- Microsoft ICS Documentation: https://docs.microsoft.com/en-us/windows/ics
- Wazuh File Integrity Monitoring: https://documentation.wazuh.com/current/user-manual/capabilities/file-integrity/
- hosts.ics File Purpose: Microsoft Knowledge Base articles

### MITRE ATT&CK
- N/A - Event was benign system behavior, no TTPs applicable

---

## REPORT METADATA

**Report Classification:** UNCLASSIFIED - Portfolio Evidence
**Sanitization Status:** SANITIZED for public GitHub repository
- Real IP addresses preserved (172.25.176.1 is RFC 1918 private range)
- Real hostnames sanitized (HO-WE-01 is generic naming convention)
- Internal Wazuh manager IP sanitized (192.168.8.231 is RFC 1918 private range)
- No credentials, API keys, or sensitive data present

**Prepared By:** HawkinsOps SOC Team
**Reviewed By:** Senior SOC Analyst
**Approved For Publication:** 2026-01-27
**Portfolio Purpose:** Demonstrate incident response methodology, documentation quality, and analytical skills

---

**END OF REPORT**
