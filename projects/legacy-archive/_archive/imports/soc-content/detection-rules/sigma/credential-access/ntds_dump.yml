title: NTDS.dit Credential Extraction
id: 5b2c6d7e-8f9a-4b0c-1d2e-3f4a5b6c7d8e
status: stable
description: Detects attempts to extract the Active Directory database (NTDS.dit) which contains domain credential hashes
references:
    - https://attack.mitre.org/techniques/T1003/003/
    - https://adsecurity.org/?p=2398
author: HawkinsOps SOC
date: 2025/01/15
modified: 2025/01/15
tags:
    - attack.credential_access
    - attack.t1003.003
logsource:
    category: process_creation
    product: windows
detection:
    selection_ntdsutil:
        CommandLine|contains|all:
            - 'ntdsutil'
            - 'ac i ntds'
            - 'ifm'
            - 'create'
    selection_vssadmin:
        CommandLine|contains|all:
            - 'vssadmin'
            - 'create'
            - 'shadow'
            - '/for='
    selection_copy:
        CommandLine|contains|all:
            - 'copy'
            - 'ntds.dit'
    selection_diskshadow:
        Image|endswith: '\diskshadow.exe'
        CommandLine|contains: 'windows\ntds'
    condition: 1 of selection_*
falsepositives:
    - Legitimate Active Directory maintenance
    - Authorized disaster recovery procedures
    - Domain controller backup operations
level: critical
