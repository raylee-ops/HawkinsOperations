<!--
  Wazuh Rule: AWS S3 Bucket Made Public
  ID: 100065
  Level: 11 (High)
  Description: Detects when S3 bucket permissions are changed to allow public access
  Author: HawkinsOps SOC
  Date: 2025-11-18
-->

<group name="aws,cloud,s3,">
  <rule id="100065" level="11">
    <if_sid>80200</if_sid>
    <field name="aws.eventName">PutBucketAcl|PutBucketPolicy</field>
    <field name="aws.requestParameters.AccessControlPolicy.AccessControlList.Grant.Grantee.URI">http://acs.amazonaws.com/groups/global/AllUsers</field>
    <description>AWS S3 bucket made publicly accessible - Potential data exposure</description>
    <mitre>
      <id>T1530</id>
    </mitre>
    <group>cloud_security,s3_exposure,</group>
  </rule>
</group>

<!--
Summary:
  Monitors AWS CloudTrail logs for S3 bucket ACL or policy changes that grant public access
  to AllUsers or AuthenticatedUsers groups, creating data exposure risk.

Fields Used:
  - aws.eventName: API call made (PutBucketAcl, PutBucketPolicy)
  - aws.requestParameters.bucketName: Affected S3 bucket
  - aws.userIdentity.principalId: User making the change
  - aws.sourceIPAddress: Source IP of API call

False Positives:
  - Intentional public buckets for static website hosting
  - Public content delivery buckets
  - Authorized changes for legitimate sharing

Severity: High (11)

MITRE ATT&CK: T1530 - Data from Cloud Storage Object

Log Sources:
  - AWS CloudTrail logs
  - Wazuh AWS integration
  - S3 server access logs

Test Examples:
  - PutBucketAcl making bucket readable by AllUsers
  - Bucket policy granting public GetObject permissions
  - ACL change allowing authenticated users access

Tuning Notes:
  - Immediately review and revert unauthorized public buckets
  - Whitelist intentionally public buckets
  - Enable S3 Block Public Access by default
  - Monitor for bulk permission changes
  - Implement least-privilege IAM policies
  - Use S3 bucket policies to restrict access
  - Enable S3 access logging for audit trails
  - Regularly audit bucket permissions
-->
