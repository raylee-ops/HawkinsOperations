<!--
  Wazuh Rule: Windows Defender Disabled
  ID: 100057
  Level: 11 (High)
  Description: Detects when Windows Defender is disabled or tampered with
  Author: HawkinsOps SOC
  Date: 2025-11-18
-->

<group name="windows,defense_evasion,">
  <rule id="100057" level="11">
    <if_sid>60000</if_sid>
    <field name="win.eventdata.newValue">^1$</field>
    <field name="win.eventdata.targetObject">\\Windows Defender\\DisableAntiSpyware|\\Real-Time Protection\\DisableRealtimeMonitoring</field>
    <description>Windows Defender has been disabled - Possible defense evasion</description>
    <mitre>
      <id>T1562.001</id>
    </mitre>
    <group>defender_disabled,defense_evasion,</group>
  </rule>
</group>

<!--
Summary:
  Monitors Windows Registry changes that disable Windows Defender real-time protection
  or anti-spyware features. Common defense evasion technique.

Fields Used:
  - win.eventdata.targetObject: Registry key modified
  - win.eventdata.newValue: New registry value (1 = disabled)
  - win.system.computer: Affected hostname
  - win.eventdata.user: User account making change

False Positives:
  - Authorized IT changes during troubleshooting
  - Software requiring Defender exclusions
  - Group Policy changes
  - Legitimate security tool installations

Severity: High (11)

MITRE ATT&CK: T1562.001 - Impair Defenses: Disable or Modify Tools

Log Sources:
  - Windows Event ID 4657 (Registry value modified)
  - Sysmon Event ID 13 (Registry value set)
  - Windows Defender operational logs

Test Examples:
  - Registry: HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\DisableAntiSpyware = 1
  - Registry: DisableRealtimeMonitoring = 1
  - PowerShell: Set-MpPreference -DisableRealtimeMonitoring $true

Tuning Notes:
  - Immediately alert security team
  - Correlate with other malware indicators
  - Check for malware execution preceding the disable
  - Verify against authorized change tickets
  - Implement GPO to prevent unauthorized changes
  - Monitor for Defender service stops
  - Track registry changes with Sysmon
-->
