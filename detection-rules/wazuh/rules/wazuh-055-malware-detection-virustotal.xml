<!--
  Wazuh Rule: Malware Detected via VirusTotal Integration
  ID: 100055
  Level: 12 (Critical)
  Description: File flagged as malicious by VirusTotal analysis
  Author: HawkinsOps SOC
  Date: 2025-11-18
-->

<group name="virustotal,malware,">
  <rule id="100055" level="12">
    <if_sid>87105</if_sid>
    <match>positives</match>
    <description>Malware detected by VirusTotal - Multiple AV engines flagged file</description>
    <mitre>
      <id>T1204</id>
    </mitre>
    <group>malware_detection,virustotal,</group>
  </rule>
</group>

<!--
Summary:
  Triggers when Wazuh VirusTotal integration identifies a file with positive malware
  detections from multiple antivirus engines. Requires VirusTotal API integration.

Fields Used:
  - file_path: Location of suspicious file
  - sha256: File hash
  - positives: Number of AV engines detecting as malicious
  - total: Total number of AV engines scanned
  - permalink: VirusTotal analysis link

False Positives:
  - Penetration testing tools
  - Security research samples
  - Packers and obfuscators on legitimate software
  - Heuristic false positives

Severity: Critical (12)

MITRE ATT&CK: T1204 - User Execution

Log Sources:
  - Wazuh VirusTotal integration
  - FIM events triggering VT lookups
  - Manual file upload results

Test Examples:
  - File with 10+ positive detections out of 60+ engines
  - Known malware samples (EICAR test file)
  - Recently created executable files flagged as malware

Tuning Notes:
  - Set threshold for positives (e.g., 5+ detections)
  - Whitelist known false positives by hash
  - Automatically quarantine high-confidence detections
  - Correlate with file creation and execution events
  - Submit unknown files to VT automatically
  - Monitor for files with low detection rate but unusual behavior
  - Implement API rate limiting for VirusTotal queries
-->
