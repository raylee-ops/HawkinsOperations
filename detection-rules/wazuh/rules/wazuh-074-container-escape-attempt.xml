<!--
  Wazuh Rule: Docker Container Escape Attempt
  ID: 100074
  Level: 12 (Critical)
  Description: Detects attempts to escape Docker container to host system
  Author: HawkinsOps SOC
  Date: 2025-11-18
-->

<group name="linux,docker,container,">
  <rule id="100074" level="12">
    <if_sid>530</if_sid>
    <match>docker.*--privileged|--cap-add=SYS_ADMIN|/var/run/docker.sock|nsenter|unshare</match>
    <description>Container escape attempt detected - Privileged container or namespace manipulation</description>
    <mitre>
      <id>T1611</id>
    </mitre>
    <group>container_escape,privilege_escalation,</group>
  </rule>
</group>

<!--
Summary:
  Detects container escape techniques including privileged container creation, Docker socket
  mounting, and namespace manipulation utilities that allow breaking out of containerization.

Fields Used:
  - command: Command executed
  - user: User executing command
  - container_id: Docker container identifier
  - image: Container image name

False Positives:
  - Legitimate privileged container usage
  - Container management tools
  - Development and testing environments
  - Docker-in-Docker scenarios

Severity: Critical (12)

MITRE ATT&CK: T1611 - Escape to Host

Log Sources:
  - Docker daemon logs
  - Auditd logs
  - Container runtime logs
  - System call monitoring

Test Examples:
  - docker run --privileged -it ubuntu /bin/bash
  - docker run -v /var/run/docker.sock:/var/run/docker.sock
  - nsenter --target 1 --mount --uts --ipc --net /bin/bash
  - Mounting host filesystem in container

Tuning Notes:
  - Restrict privileged container creation
  - Disable Docker socket mounting in production
  - Implement container runtime security policies
  - Use user namespaces for isolation
  - Monitor for unusual process activity in containers
  - Implement pod security policies (Kubernetes)
  - Alert on container processes accessing host resources
  - Regularly audit container configurations
-->
