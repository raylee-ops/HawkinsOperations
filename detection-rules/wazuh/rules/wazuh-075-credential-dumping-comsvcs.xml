<!--
  Wazuh Rule: LSASS Memory Dump via comsvcs.dll
  ID: 100075
  Level: 13 (Critical)
  Description: Detects credential dumping using comsvcs.dll MiniDump technique
  Author: HawkinsOps SOC
  Date: 2025-11-18
-->

<group name="windows,credential_access,">
  <rule id="100075" level="13">
    <if_sid>60000</if_sid>
    <field name="win.eventdata.image">\\rundll32.exe$</field>
    <field name="win.eventdata.commandLine">comsvcs.*MiniDump|comsvcs.*full</field>
    <description>LSASS memory dump detected using comsvcs.dll - Credential theft attempt</description>
    <mitre>
      <id>T1003.001</id>
    </mitre>
    <group>credential_dumping,lsass_dump,</group>
  </rule>
</group>

<!--
Summary:
  Detects rundll32.exe calling comsvcs.dll's MiniDump function to dump LSASS process memory,
  a stealthy credential theft technique that bypasses some security controls.

Fields Used:
  - win.eventdata.commandLine: Full command line
  - win.eventdata.image: Process path (rundll32.exe)
  - win.eventdata.user: User context
  - win.eventdata.parentImage: Parent process

False Positives:
  - Extremely rare - this technique is almost exclusively malicious
  - Authorized forensic/IR activities
  - Troubleshooting by Microsoft support

Severity: Critical (13)

MITRE ATT&CK: T1003.001 - OS Credential Dumping: LSASS Memory

Log Sources:
  - Sysmon Event ID 1 (Process Creation)
  - Windows Security Event 4688
  - Sysmon Event ID 10 (Process Access to lsass.exe)

Test Examples:
  - rundll32.exe C:\\Windows\\System32\\comsvcs.dll,MiniDump 612 C:\\temp\\lsass.dmp full
  - rundll32 comsvcs MiniDump <LSASS_PID> dump.bin full
  - Automated exploitation tools using comsvcs technique

Tuning Notes:
  - Alert immediately and investigate
  - Assume credential compromise if detected
  - Block rundll32 calling comsvcs.dll via ASR rules
  - Enable Credential Guard to protect LSASS
  - Monitor for file creation of dump files
  - Check for subsequent lateral movement
  - Reset passwords for accounts on affected systems
  - Implement LSA protection (RunAsPPL)
-->
