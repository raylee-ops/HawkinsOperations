<!--
  Wazuh Rule: Suspicious Sudo Password Change
  ID: 100066
  Level: 10 (High)
  Description: Detects password changes for privileged accounts via sudo
  Author: HawkinsOps SOC
  Date: 2025-11-18
-->

<group name="linux,sudo,">
  <rule id="100066" level="10">
    <if_group>sudo</if_group>
    <match>COMMAND=/usr/bin/passwd root|COMMAND=/usr/bin/passwd admin</match>
    <description>Privileged account password changed via sudo - Verify authorization</description>
    <mitre>
      <id>T1098</id>
    </mitre>
    <group>account_manipulation,sudo_abuse,</group>
  </rule>
</group>

<!--
Summary:
  Monitors sudo logs for passwd command execution targeting privileged accounts (root, admin)
  which may indicate unauthorized account takeover or persistence.

Fields Used:
  - user: User executing sudo command
  - command: Full command executed
  - tty: Terminal session
  - pwd: Working directory

False Positives:
  - Legitimate password rotation by administrators
  - Authorized account management
  - Scheduled password changes per policy

Severity: High (10)

MITRE ATT&CK: T1098 - Account Manipulation

Log Sources:
  - /var/log/auth.log (Debian/Ubuntu)
  - /var/log/secure (RHEL/CentOS)
  - Sudo logs

Test Examples:
  - sudo passwd root
  - sudo passwd admin
  - sudo chpasswd (bulk password changes)

Tuning Notes:
  - Whitelist authorized administrators
  - Correlate with change management tickets
  - Alert on password changes outside maintenance windows
  - Monitor for password changes following compromise indicators
  - Require MFA for privileged password changes
  - Log all sudo activity for audit trail
  - Implement password complexity and rotation policies
-->
